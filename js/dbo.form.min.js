/*!
 * dbo.form.js
 * by Christian Fillies
 * Modified: (11/20/2019)
 *
 */
jQuery.fn.extend({fieldFocus:function(t){return jQuery(this).each((function(){var e=jQuery(this);jQuery(this).click((function(){jQuery(this).find(".input:not([disabled]), .bootstrap-tagsinput input")&&(e.parents(".dbo_form, form").find("."+t).removeClass(t),e.find(".input_container:not(.view_only)").addClass(t),!1===jQuery(this).find(".input:not([disabled])").is("textarea")&&jQuery(this).find(".input:not([disabled])").focus()),jQuery(this).find(".input:not([disabled]), .bootstrap-tagsinput input").focus((function(){e.parents(".dbo_form, form").find("."+t).removeClass(t),e.find(".input_container:not(.view_only)").addClass(t),jQuery(this).find("select").click()}))})),jQuery(this).find(".input:not([disabled]), .bootstrap-tagsinput input").focus((function(){e.parents(".dbo_form, form").find("."+t).removeClass(t),e.find(".input_container:not(.view_only)").addClass(t)})),jQuery(this).find(".input:not([disabled]), .bootstrap-tagsinput input").blur((function(){e.find(".input_container:not(.view_only)").removeClass(t)}))}))}}),jQuery.fn.extend({dboForms:function(){var t="form_row",e="error",n="input_container",i="input",a="onChangeHook",o="i.dbo",d="ui-menu",s="type_picker",r="placeholder",u="choice",l="hint",f="bootstrap-tagsinput",c="input_container_with_hint",h="input_triggers",m="input_container_with_btns",g="btn",p="value_set",b="disabled",v="active",y="focus";debug=function(t,e){if(window.location.toString().toLowerCase().indexOf("debugforms")>-1)return void 0!==t&&(void 0!==e?console.debug("dbo.forms: "+t,e):console.debug("dbo.forms: "+t)),!0},error=function(t,e){if(window.location.toString().toLowerCase().indexOf("debugforms")>-1)return void 0!==t&&(void 0!==e?console.error("dbo.forms: "+t,e):console.error("dbo.forms: "+t)),!0},debug("intializing",null),this.find('[data-tooltip="true"]').tooltip(),this.find("."+t).fieldFocus(y),this.find("."+n).not("."+g).each((function(e,a){var o=jQuery(a),d=o.outerWidth(),s=o.find("."+i),g=s.attr("type"),v=d,y=s.val(),_=jQuery(a).parent("."+t),C=s.attr("disabled"),j=o.find("."+l),Q=0,w=(o.find("."+u),o.find("."+h)),k=0,$=(o.find("."+r),o.find("."+i+", ."+r+", ."+u+", ."+f)),x=0;s.length>0?debug(n+" loop: input: ",s):error(n+' loop: no input with a class of "input" found in ',o),w.length&&(o.addClass(m),k=w.outerWidth(),x=1),o.find("textarea").length&&(x=2),j.length&&(o.addClass(c),Q=j.outerWidth()),(j.length||w.length)&&(v=d-Q-k-x),"number"===g&&(v-=5),$.css({width:v,"margin-left":Q,"margin-right":k}),"disabled"===C&&_.addClass(b),""===y||null==y||(debug(n+" loop: value ["+y+"] found, adding $css.hasVaue",null),_.addClass(p),_.find('[data-event~="clear_input"]').fadeIn()),s.click((function(){debug(n+" loop: click detected, adding $css.hasVaue",null),_.addClass(p),_.find('[data-event~="clear_input"]').fadeIn()})),s.blur((function(){""===jQuery(this).val()||null===jQuery(this).val()||void 0===jQuery(this).val()?(_.removeClass(p),_.find('[data-event~="clear_input"]').fadeOut(),debug("blur detected, no value, removing $css.hasVaue",jQuery(this))):(_.addClass(p),_.find('[data-event~="clear_input"]').show(),debug("blur detected, has value, adding $css.hasVaue",jQuery(this)))})),_.find('[data-event~="clear_input"]').each((function(){var t=jQuery(this);t.hide(),t.click((function(){t.parents("."+n).find("."+i).val(""),t.parents(".form_row ").removeClass(p)}))}))})),this.find('.input[type="email"]').unbind("change"),this.find('.input[type="email"]').change((function(){var n=jQuery(this).val();/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/.test(n)?jQuery(this).parents("."+t).removeClass(e):jQuery(this).parents("."+t).addClass(e)})),this.find(".type_textarea").each((function(t,e){jQuery(e).find("textarea")})),this.find(".type_toggle").each((function(t,e){var n=jQuery(e).find(".form_btn, ."+g).attr("data-toggle-from"),a=n,d=jQuery(e).find(".form_btn, ."+g).attr("data-toggle-to"),s=d,r=jQuery(e).find("."+i),u=jQuery(e).find(o);debug(".type_toggle",jQuery(e)),jQuery(e).find(".form_btn, ."+g).attr("data-toggle-iconTo")&&(s=jQuery(e).find(".form_btn, ."+g).attr("data-toggle-iconTo")),jQuery(e).find(".form_btn, ."+g).attr("data-toggle-iconFrom")&&(a=jQuery(e).find(".form_btn, ."+g).attr("data-toggle-iconFrom"));var l=function(){var t;f?(t=d,u.removeClass(a).addClass(s),debug(".type_toggle: changing to iconTo.",null)):(t=n,u.removeClass(s).addClass(a),debug(".type_toggle: changing to iconFrom.",null)),r.val()!==t&&(debug(".type_toggle: changing input from:"+r.val()+" to:"+t,null),r.val(t).change()),f=!f};jQuery(e).unbind("click"),jQuery(e).find("a.btn").bind("click",l);var f=!0;if(r.val()===n)f=!1;l()})),this.find(".type_combo, .type_combined, .type_picker, .type_message-history").each((function(e,r){var l=jQuery(r),f=l.find("."+i),c=l.find("button"),m=l.find("."+a),b=l.find(".menu > ul"),_=l.find("."+u),C=l.find("."+n+", label, .form_btn, ."+g);f.is("textarea")&&(C=l.find("."+h+", label, .form_btn, ."+g));var j=l,Q=j.parent("."+t),w=j.find("."+n),k=w.width();f.attr("id"),f.attr("name"),f.attr("type");debug("type_combo||type_combined||type_picker||type_message-history",f),k<201&&(k=200),l.is("."+s)&&(w=j.find("."+n+", .form_btn, ."+g)),(f.is(":text")||f.is("textarea"))&&j.addClass("has-text-input"),Q&&Q.find("."+s).length;var x={focus:function(t,e){var i=$(e.item);j.addClass(y).find("."+g).addClass(y).find(o).addClass(v),j.find("."+n).addClass(y),i.focus()},blur:function(t,e){j.removeClass(y).find("."+g).removeClass(y).find(o).removeClass(v),j.find("."+n).removeClass(y)},select:function(t,e){var i=$(e.item).find("> a"),a=i.attr("data-value"),d=i.attr("data-choice"),s=i.attr("data-icon-choice"),r=i.html(),u=i.text().trim(),l="_blank"===a?"":a;debug("click detected on li a",i),_.length&&(d?_.html(d):s?(_.html(u),_.prepend('<i class="dbo '+s+'"></i>')):s&&d?(_.html(d),_.prepend('<i class="dbo '+s+'"></i>')):_.html(r));for(var c=0,h=i[0].attributes,C=h.length;c<C;c++){var Q=h[c].nodeName;if("data-value-"===Q.substring(0,11)&&"data-value-1"!==Q&&"data-value-2"!==Q){debug("custom data value:: "+Q,null),Q="."+Q.substring(11,Q.length);var w=h[c].nodeValue,k=j.find(Q);k.length?(debug("custom data value: matching input found, setting value: "+w,null),k.val(w).change()):error('custom data value: Unable to find hidden input with class "'+Q+'"',null)}}if(a?(f.val(l).change(),m.length&&m.trigger("change")):(f.val(u).change(),m.length&&m.trigger("change")),"modal"===i.data("toggle")){var x=i.data("target");$(x).on("shown.bs.modal",(function(t){$(x).find(".dbo_form").dboForms(),$(x).find(".dbo_form .input").first().focus(),$(x).find(".dbo_form .input").first().val(l)}))}return b.hide(),$("body").css("cursor",""),j.removeClass(y).addClass(p).find("."+g).removeClass(y).find(o).removeClass(v),j.find("."+n).removeClass(y),"_blank"===a&&(f.focus().val("").change(),j.addClass(y).removeClass(p),_.html(""),b.hide()),j.focus(),!1}};b.menu(x).css("width",k+"px").find("."+d).css("width",k/2+"px"),$(document).off("keydown.menu keyup.menu").on("keydown.menu keyup.menu",(function(t){13===t.which&&"keydown"===t.type&&$(t.target).closest(".ui-menu-item")&&$(t.target).closest(".ui-menu-item").length&&$(t.target).closest("a").trigger("click.menu.item"),27===t.which&&"keyup"===t.type&&$(t.target).closest(".ui-menu").length&&$("."+d).hide()})),C.on("click.menu",(function(t){return j.parents(".dbo_form, form").find("."+y).removeClass(y),j.addClass(y).find("."+g).addClass(y).find(o).addClass(v),j.find("."+n).addClass(y),$("."+d).hide(),b.show().position({my:"left top",at:"left bottom",of:w,collision:"flipfit"}),b.menu("focus",null,b.find(".ui-menu-item:first")),$("body").css("cursor","pointer"),!1})),c.on("focus.menu.button",(function(){C.trigger("click.menu")})),f.focus((function(){return j.addClass(y).find("."+g).addClass(y).find(o).addClass(v),j.find("."+n).addClass(y),$("."+d).hide(),f.is("textarea")||b.show(),$("body").css("cursor","pointer"),!1})),f.blur((function(){return j.removeClass(y).find("."+g).removeClass(y).find(o).removeClass(v),j.find("."+n).removeClass(y),$("."+d).hide(),j.focus(),!1}));var F=function(){$("body").on("click.menu.close",(function(t){"click"===t.type&&($(t.target).closest(b).length||b.is(t.target)||f.is(t.target)||(b.hide(),$("body").off("click.menu.off"),$("body").css("cursor",""),j.focus()))}))};b.mouseleave((function(){F()})),l.mouseleave((function(){F()})),jQuery("body").off("click.menu.off"),jQuery("body").on("click.menu.off",(function(t){$(t.target).closest(b).length||b.is(t.target)||f.is(t.target)||(b.hide(),$("body").css("cursor",""),j.focus())})),f.keypress((function(){j.hasClass(y)||j.addClass(y)}))})),this.find(".type_confirm-password").each((function(n,a){var o=$(this),d=o.find("."+i),s=o.prev("."+t),r=s.find("."+i);d.blur((function(){d.val()!==r.val()?(o.addClass(e),s.addClass(e)):(o.removeClass(e),s.removeClass(e))}))})),this.find(".type_date").each((function(t,e){var n=$(this),a=n.width(),o=n.find(i),d=n.find('[data-event~="jquery-ui_cal"]'),s=n.find("."+r),u=n.find("."+h).width();o.datepicker({altField:o,altFormat:"mm-dd-yy",onSelect:function(){s.hide(),n.addClass(p)}}).css("width",a-2*u-20),d.click((function(){return o.datepicker("show"),o.datepicker("refresh"),!1})),o.blur((function(){""===o.val()?s.show():n.addClass(p)}))}))}}),$.fn.donetyping=function(t,e){var n;e||(e=1e3);var i=function(e){n&&(n=null,t(e))};return this.each((function(){var t=$(this);t.on("keyup",(function(){n&&clearTimeout(n),n=setTimeout((function(){i(t)}),e)})).on("blur",(function(){i(t)}))})),this},jQuery((function(){jQuery(".dbo_form").dboForms()})),jQuery(window).resize((function(){jQuery(".dbo_form").dboForms()}));