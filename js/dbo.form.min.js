/*!
 * dbo.form.js
 * by Christian Fillies
 * Modified: (12/03/2019)
 *
 */
jQuery.fn.extend({fieldFocus:function(t){return jQuery(this).each((function(){var e=jQuery(this);jQuery(this).click((function(){jQuery(this).find(".input:not([disabled]), .bootstrap-tagsinput input")&&(e.parents(".dbo_form, form").find("."+t).removeClass(t),e.find(".input_container:not(.view_only)").addClass(t),!1===jQuery(this).find(".input:not([disabled])").is("textarea")&&jQuery(this).find(".input:not([disabled])").focus()),jQuery(this).find(".input:not([disabled]), .bootstrap-tagsinput input").focus((function(){e.parents(".dbo_form, form").find("."+t).removeClass(t),e.find(".input_container:not(.view_only)").addClass(t),jQuery(this).find("select").click()}))})),jQuery(this).find(".input:not([disabled]), .bootstrap-tagsinput input").focus((function(){e.parents(".dbo_form, form").find("."+t).removeClass(t),e.find(".input_container:not(.view_only)").addClass(t)})),jQuery(this).find(".input:not([disabled]), .bootstrap-tagsinput input").blur((function(){e.find(".input_container:not(.view_only)").removeClass(t)}))}))}}),jQuery.fn.extend({dboForms:function(){var t={formRow:"form_row",error:"error",container:"input_container",input:"input",onChangeHook:"onChangeHook",icon:"i.dbo",menu:"ui-menu",picker:"type_picker",placeholder:"placeholder",choice:"choice",hint:"hint",tagsinput:"bootstrap-tagsinput",hasHint:"input_container_with_hint",triggers:"input_triggers",hasTriggers:"input_container_with_btns",button:"btn",handle:"handle",hasValue:"value_set",disabled:"disabled",active:"active",focus:"focus",fullScreen:"full_screen"};debug=function(t,e){if(window.location.toString().toLowerCase().indexOf("debugforms")>-1)return void 0!==t&&(void 0!==e?console.debug("dbo.forms: "+t,e):console.debug("dbo.forms: "+t)),!0},error=function(t,e){if(window.location.toString().toLowerCase().indexOf("debugforms")>-1)return void 0!==t&&(void 0!==e?console.error("dbo.forms: "+t,e):console.error("dbo.forms: "+t)),!0},debug("intializing",null),this.find('[data-tooltip="true"]').tooltip(),this.find("."+t.formRow).fieldFocus(t.focus),this.find("."+t.container).not("."+t.button).each((function(e,n){var i=jQuery(n),o=i.outerWidth(),a=i.find("."+t.input),s=a.attr("type"),r=o,u=a.val(),d=jQuery(n).parent("."+t.formRow),c=a.attr("disabled"),l=i.find("."+t.hint),f=0,h=(i.find("."+t.choice),i.find("."+t.triggers)),m=0,g=(i.find("."+t.placeholder),i.find("."+t.input+", ."+t.placeholder+", ."+t.choice+", ."+t.tagsinput)),p=0;a.length>0?debug(t.container+" loop: input: ",a):error(t.container+' loop: no input with a class of "input" found in ',i),h.length&&(i.addClass(t.hasTriggers),m=h.outerWidth(),p=1),i.find("textarea").length&&(p=2),l.length&&(i.addClass(t.hasHint),f=l.outerWidth()),(l.length||h.length)&&(r=o-f-m-p),"number"===s&&(r-=5),g.css({width:r,"margin-left":f,"margin-right":m}),"disabled"===c&&d.addClass(t.disabled),""===u||null==u||(debug(t.container+" loop: value ["+u+"] found, adding $css.hasVaue",null),d.addClass(t.hasValue),d.find('[data-event~="clear_input"]').fadeIn()),a.click((function(){return debug(t.container+" loop: click detected, adding $css.hasVaue",null),d.addClass(t.hasValue),d.find('[data-event~="clear_input"]').fadeIn(),!1})),a.blur((function(){""===jQuery(this).val()||null===jQuery(this).val()||void 0===jQuery(this).val()?(d.removeClass(t.hasValue),d.find('[data-event~="clear_input"]').fadeOut(),debug("blur detected, no value, removing $css.hasVaue",jQuery(this))):(d.addClass(t.hasValue),d.find('[data-event~="clear_input"]').show(),debug("blur detected, has value, adding $css.hasVaue",jQuery(this)))})),d.find('[data-event~="clear_input"]').each((function(){var e=jQuery(this);e.hide(),e.click((function(){e.parents("."+t.container).find("."+t.input).val(""),e.parents(".form_row ").removeClass(t.hasValue)}))}))})),this.find('.input[type="email"]').unbind("change"),this.find('.input[type="email"]').change((function(){var e=jQuery(this).val();/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/.test(e)?jQuery(this).parents("."+t.formRow).removeClass(t.error):jQuery(this).parents("."+t.formRow).addClass(t.error)})),this.find(".type_textarea").each((function(t,e){jQuery(e).find("textarea")})),this.find(".type_toggle").each((function(e,n){var i=jQuery(n).find(".form_btn, ."+t.button).attr("data-toggle-from"),o=i,a=jQuery(n).find(".form_btn, ."+t.button).attr("data-toggle-to"),s=a,r=jQuery(n).find("."+t.input),u=jQuery(n).find(t.icon);debug(".type_toggle",jQuery(n)),jQuery(n).find(".form_btn, ."+t.button).attr("data-toggle-iconTo")&&(s=jQuery(n).find(".form_btn, ."+t.button).attr("data-toggle-iconTo")),jQuery(n).find(".form_btn, ."+t.button).attr("data-toggle-iconFrom")&&(o=jQuery(n).find(".form_btn, ."+t.button).attr("data-toggle-iconFrom"));var d=function(){var t;c?(t=a,u.removeClass(o).addClass(s),debug(".type_toggle: changing to iconTo.",null)):(t=i,u.removeClass(s).addClass(o),debug(".type_toggle: changing to iconFrom.",null)),r.val()!==t&&(debug(".type_toggle: changing input from:"+r.val()+" to:"+t,null),r.val(t).change()),c=!c};jQuery(n).unbind("click"),jQuery(n).find("a.btn").bind("click",d);var c=!0;if(r.val()===i)c=!1;d()})),this.find(".type_combo, .type_combined, .type_picker, .type_message-history").each((function(e,n){var i=jQuery(n),o=i.is(".type_message-history"),a=i.find("."+t.input),s=i.find("button"),r=i.find("."+t.onChangeHook),u=i.find(".menu > ul"),d=i.find("."+t.choice),c=i.find("."+t.container+", label, .form_btn, ."+t.button);a.is("textarea")&&(c=i.find("."+t.triggers+", label, .form_btn, ."+t.button));var l=i,f=l.parent("."+t.formRow),h=l.find("."+t.container),m=h.width();a.attr("id"),a.attr("name"),a.attr("type");debug("type_combo||type_combined||type_picker||type_message-history",a),m<201&&(m=200),i.is("."+t.picker)&&(h=l.find("."+t.container+", .form_btn, ."+t.button)),(a.is(":text")||a.is("textarea"))&&l.addClass("has-text-input"),f&&f.find("."+t.picker).length;var g={focus:function(e,n){var i=n.item;i.removeClass(t.uiStateFocus),o||(l.addClass(t.focus).find("."+t.button).addClass(t.focus),l.find("."+t.container).addClass(t.focus)),l.find(t.icon).addClass(t.active),i.first().addClass(t.uiStateFocus).focus()},blur:function(e,n){l.removeClass(t.focus).find("."+t.button).removeClass(t.focus),l.find(t.icon).removeClass(t.active),l.find("."+t.container).removeClass(t.focus)},select:function(e,n){var i=e.currentTarget&&e.originalEvent&&"click"===e.originalEvent.type?$(e.currentTarget).find("> a"):$(n.item).find("> a"),o=i.attr("data-value"),s=i.attr("data-choice"),c=i.attr("data-icon-choice"),f=i.html(),h=i.text().trim(),m="_blank"===o?"":o;if(debug("click detected on li a",i),d.length&&(s?d.html(s):c?(d.html(h),d.prepend('<i class="dbo '+c+'"></i>')):c&&s?(d.html(s),d.prepend('<i class="dbo '+c+'"></i>')):d.html(f)),i[0])for(var g=0,p=i[0].attributes,b=p.length;g<b;g++){var v=p[g].nodeName;if("data-value-"===v.substring(0,11)&&"data-value-1"!==v&&"data-value-2"!==v){debug("custom data value:: "+v,null),v="."+v.substring(11,v.length);var y=p[g].nodeValue,C=l.find(v);C.length?(debug("custom data value: matching input found, setting value: "+y,null),C.val(y).change()):error('custom data value: Unable to find hidden input with class "'+v+'"',null)}}if(o?(a.val(m).change(),r.length&&r.trigger("change")):(a.val(h).change(),r.length&&r.trigger("change")),"modal"===i.data("toggle")){var _=i.data("target");$(_).on("shown.bs.modal",(function(t){$(_).find(".dbo_form").dboForms(),$(_).find(".dbo_form .input").first().focus(),$(_).find(".dbo_form .input").first().val(m)}))}return u.hide(),$("body").css("cursor",""),l.removeClass(t.focus).addClass(t.hasValue).find("."+t.button).removeClass(t.focus).find(t.icon).removeClass(t.active),l.find("."+t.container).removeClass(t.focus),"_blank"===o&&(a.focus().val("").change(),l.addClass(t.focus).removeClass(t.hasValue),d.html(""),u.hide()),l.focus(),!1}};u.menu(g).css("width",m+"px").find("."+t.menu).css("width",m/2+"px"),$(document).off("keydown.menu keyup.menu").on("keydown.menu keyup.menu",(function(e){13===e.which&&"keydown"===e.type&&$(e.target).closest(".ui-menu-item")&&$(e.target).closest(".ui-menu-item").length&&$(e.target).closest("a").trigger("click.menu.item"),27===e.which&&"keyup"===e.type&&$(e.target).closest(".ui-menu").length&&$("."+t.menu).hide()})),c.on("click.menu",(function(e){return l.parents(".dbo_form, form").find("."+t.focus).removeClass(t.focus),o||(l.addClass(t.focus).find("."+t.button).addClass(t.focus),l.find("."+t.container).addClass(t.focus)),l.find(t.icon).addClass(t.active),$("."+t.menu).hide(),u.show().position({my:"left top",at:"left bottom",of:h,collision:"flipfit"}),u.menu("focus",null,u.find(".ui-menu-item:first")),$("body").css("cursor","pointer"),!1})),s.on("focus.menu.button",(function(){c.trigger("click.menu")})),a.focus((function(){return o||(l.addClass(t.focus).find("."+t.button).addClass(t.focus),l.find("."+t.container).addClass(t.focus)),l.find(t.icon).addClass(t.active),$("."+t.menu).hide(),a.is("textarea")||u.show(),$("body").css("cursor","pointer"),!1})),a.blur((function(){return l.removeClass(t.focus).find("."+t.button).removeClass(t.focus).find(t.icon).removeClass(t.active),l.find("."+t.container).removeClass(t.focus),$("."+t.menu).hide(),l.focus(),!1}));var p=function(){$("body").on("click.menu.close",(function(t){"click"===t.type&&($(t.target).closest(u).length||u.is(t.target)||a.is(t.target)||(u.hide(),$("body").off("click.menu.off"),$("body").css("cursor",""),l.focus()))}))};u.mouseleave((function(){p()})),i.mouseleave((function(){p()})),jQuery("body").off("click.menu.off"),jQuery("body").on("click.menu.off",(function(t){$(t.target).closest(u).length||u.is(t.target)||a.is(t.target)||(u.hide(),$("body").css("cursor",""),l.focus())})),a.keypress((function(){l.hasClass(t.focus)||o||l.addClass(t.focus)}))})),this.find(".type_confirm-password").each((function(e,n){var i=$(this),o=i.find("."+t.input),a=i.prev("."+t.formRow),s=a.find("."+t.input);o.blur((function(){o.val()!==s.val()?(i.addClass(t.error),a.addClass(t.error)):(i.removeClass(t.error),a.removeClass(t.error))}))})),this.find(".type_date").each((function(e,n){var i=$(this),o=i.width(),a=i.find(t.input),s=i.find('[data-event~="jquery-ui_cal"]'),r=i.find("."+t.placeholder),u=i.find("."+t.triggers).width();a.datepicker({altField:a,altFormat:"mm-dd-yy",onSelect:function(){r.hide(),i.addClass(t.hasValue)}}).css("width",o-2*u-20),s.click((function(){return a.datepicker("show"),a.datepicker("refresh"),!1})),a.blur((function(){""===a.val()?r.show():i.addClass(t.hasValue)}))}))}}),$.fn.donetyping=function(t,e){var n;e||(e=1e3);var i=function(e){n&&(n=null,t(e))};return this.each((function(){var t=$(this);t.on("keyup",(function(){n&&clearTimeout(n),n=setTimeout((function(){i(t)}),e)})).on("blur",(function(){i(t)}))})),this},jQuery((function(){jQuery(".dbo_form").dboForms()})),jQuery(window).resize((function(){jQuery(".dbo_form").dboForms()}));